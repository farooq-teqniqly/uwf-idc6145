\documentclass{article}
\usepackage{graphicx} % Required for inserting images
\usepackage{listings}
\usepackage{xcolor}
\usepackage{geometry}
\usepackage{parskip}
\usepackage{amsmath}
\usepackage{url}

\geometry{
 letterpaper,
 left=20mm,
 top=20mm,
 }
 
\graphicspath{{images/}}

\title{\vspace{-2cm}Temporal Congestion Analysis and Predictive Modeling of Ride-Hailing Trips in NYC Using High-Volume FHV Data}
\author{Farooq Mahmud}
\date{April 25, 2025}

\definecolor{backcolor}{rgb}{0.95,0.95,0.92}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolor},
    captionpos=b                  
}

\lstset{style=mystyle}

\begin{document}

\maketitle

\section{Abstract}
This paper explores traffic congestion patterns in New York City by analyzing High-Volume For-Hire Vehicle (FHV) trip records from services like Uber and Lyft. Using data from all 12 months of 2024, we investigate how trip durations and speeds vary by time of day, day of week, and provider. After extensive preprocessing in PySpark, we identify temporal trends and build predictive models in R using linear and logistic regression. The study demonstrates that the dataset size and analysis complexity necessitate big data tools for processing and modeling at scale.


\section{Introduction}
Urban traffic congestion continues to be a pervasive problem affecting the efficiency of transportation systems, contributing to environmental concerns, and impacting commuter well-being. In densely populated cities like New York, where ride-hailing services such as Uber and Lyft operate at massive scale, understanding when and where congestion occurs is critical for optimizing urban mobility.
This project investigates temporal patterns in congestion using High-Volume For-Hire Vehicle (FHV) trip data collected and published by the NYC Taxi and Limousine Commission (TLC). With over 200 million trip records from 2024 alone, the dataset provides a rich source of behavioral and operational insights. The central research question is: How do trip duration and speed, as proxies for congestion, vary across different times of day, days of the week, and ride-hailing providers?
The objectives of the study are to (1) identify temporal congestion trends through descriptive analysis, and (2) develop regression models to predict trip duration or classify trips as congested based on their features. Given the volume and granularity of the dataset, traditional analysis tools fall short, necessitating the use of big data processing technologies like Apache Spark. This research aims to produce interpretable insights that can inform urban planning, traffic policy, and ride-hailing operations.

\section{Testing for Equal Means (Assuming Normality)}

The mean diabetes for each state appear to be very different for the six states as shown in the box plots in \ref{appendix:boxplots}. However, this is not a true statistical test. In order to properly test for equal means, an ANOVA $F$-test is performed. Each state is a group and the null hypothesis is that mean diabetes level for all states are equal. The program in Listing \ref{lst:anova} outputs the $F$-test results shown in Table \ref{tab:anova}.

\begin{lstlisting}[language=SAS,caption=ANOVA F-test SAS progam,captionpos=b,label=lst:anova]
    proc glm data=proj.alz;
    class state;
    model diabetes=state;
    run;
\end{lstlisting}

\begin{table}[ht]
    \begin{tabular}{ll}
         \includegraphics[scale=0.7]{images/f-test.png} & \includegraphics[scale=0.6]{images/f-test-boxplots.png} \\
    \end{tabular}
    \caption{Normality test results for the diabetes variable}
    \label{tab:anova}
\end{table}

\subsubsection{Interpretation}
The ANOVA $F$-test $p$-value is less than $\alpha$. Therefore the null hypothesis is rejected. The mean diabetes level for the states are not equal. 

The side-by-side box plots visually show the differences in means. California has the lowest level of diabetes and Georgia the highest. Subsequent sections will apply statistical tests to analytically determine which states are statistically significantly different from each other.

\section{Testing for Equal Variances}
Two methods in SAS exist to test for equal variances amongst groups - Bartlett's test and the Brown-Forsythe-Levene (BFL) test.

Bartlett's test is not appropriate to use with this data because it assumes equal sample sizes. As can be seen in Figure \ref{fig:state-freq}, the sample sizes are not equal for each state. The BFL test is not limited by this constraint. The program in \ref{lst:bfl} runs the BFL-test. The test's output is in Figure \ref{fig:bfl}. 

\begin{lstlisting}[language=SAS,caption=BFL test SAS progam,captionpos=b,label=lst:bfl]
    proc glm data=proj.alz;
    class state;
    model diabetes=state;
    means state/hovtest=bf;
    run;
\end{lstlisting}

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.7]{images/bfl.png}
    \caption{BFL test results}
    \label{fig:bfl}
\end{figure}

\subsection{Interpretation}
The $p$-value for the BFL test statistic is less than $\alpha$. Therefore, the null hypothesis that the states have equal variances is rejected. The reader can reconcile this with the side-by-side box plots in Table \ref{tab:anova}.

\section{Testing for Equal Means (Assuming non-Normality)}
As stated in \ref{normality-interpretation}, the Central Limit Theorem allows the diabetes data to be treated as if it were normally distributed. However methods do exist to test for equal means when the data is not normal. One such method is the Kruskal-Wallis test.

\subsection{Kruskal-Wallis Test}
The null hypothesis of the Kruskal-Wallis (KW) test is that all \textit{distributions}, \textit{i.e.} means and variances are equal. The code in Listing \ref{lst:kw} runs the KW test. The program's output is shown in Figure \ref{fig:kw}.

\begin{lstlisting}[language=SAS,caption=Kruskal-Wallis test SAS progam,captionpos=b,label=lst:kw]
    proc npar1way wilcoxon data=proj.alz;
    class state;
    var diabetes;
    run;
\end{lstlisting}

\begin{figure}[ht]
    \centering
    \includegraphics[scale=1]{images/kw.png}
    \caption{Kruskal-Wallis test result}
    \label{fig:kw}
\end{figure}

\subsubsection{Interpretation}
The $p$-value for the KW test statistic is less than $\alpha$. Therefore the null hypothesis that all distributions are equal is rejected. This result reconciles with the results of the ANOVA $F$-test (all means are not equal) and the BFL test (all variances are not equal).

\section{Multiple Comparisons}
The statistical tests done so far have shown that the mean level of diabetes amongst the states are not equal. This begs the question - "which states are significantly different from each other?" Multiple comparison tests helps answer this question. 

SAS supports several such tests as shown in Table \ref{tab:mc-tests}.

\begin{table}[ht]
    \centering
    \begin{tabular}{|c|c|c|}
    \hline
        Fisher's Least Significant Difference (LSD) & Bonferroni & Sidak \\
        \hline
         Tukey & Student-Newman-Keuls (SNK) & Duncan \\
         \hline
    \end{tabular}
    \caption{Multiple comparisons tests}
    \label{tab:mc-tests}
\end{table}

Listing \ref{lst:mc} shows the SAS program that runs all of the aforementioned multiple comparison tests. The test results are shown in \ref{appendix:mc-diabetes}.

\begin{lstlisting}[language=SAS,caption=Multiple comparison tests SAS progam,captionpos=b,label=lst:mc]
    proc glm data=proj.alz;
    class state;
    model diabetes=state;
    means state/lsd bon sidak tukey snk duncan lines;
    run;
\end{lstlisting}


\subsection{Interpretation}
States connected by the same line are not statistically significantly different at the pre-determined $\alpha$ level of $0.05$. All the tests show that Florida and Virginia's mean diabetes levels are not significantly different. The box plots visually show that the states' mean diabetes levels are close. The remaining states are all significantly different from every other state. As can be gleaned from the box plots, Georgia and California have the highest and lowest mean diabetes levels, respectively. 

Although all tests gave the same result, this is not always the case. Running the program in Listing \ref{lst:mc} with the cancer variable gives the result shown in \ref{appendix:mc-cancer}. Fisher's LSD, SNK, and Duncan's tests have the same result. Bonferroni's, Sidak, and Tukey's tests have the same result but the groups differ from the other three tests.

\subsection{Contrasts}
Another interesting question to ask is "Does the mean diabetes level significantly differ between west coast and east coast states?" Contrasts can help answer this question using statistical tests.

Assume California and Washington are west coast states. Assume Florida, Georgia, and Virginia are east coast states. The SAS program in Listing \ref{lst:contrasts-coast} runs this test.

\begin{lstlisting}[language=SAS,caption=Contrast SAS program comparing west coast and east coast states,captionpos=b,label=lst:contrasts-coast]
    proc sort data=proj.alz;
    by state;
    run;
    
    proc glm data=proj.alz;
    class state;
    model diabetes=state;
    contrast 'West coast vs. East coast states' state -3 2 2 0 2 -3;
    run;
\end{lstlisting}

The test result is shown in Figure \ref{fig:mc-coast-result}.

\begin{figure}[ht]
    \centering
    \includegraphics[scale=1]{images/multiple-comparisons/contrast-coasts.png}
    \caption{West coast vs. east coast constrast test result}
    \label{fig:mc-coast-result}
\end{figure}

\subsubsection{Interpretation}
The $p$-value of the test statistic is less than $\alpha$. Therefore, the null hypothesis that the mean diabetes level for west coast and east coast states are equal is rejected.

\section{Analyzing Categorical Data}
Suppose the diabetes variable is classified into four categories - "Low", "Medium", "High" and "Severe". A $\chi^2$ test for homogeneity can be carried out to determine if the four groups within each state are homogeneous.

Listing \ref{lst:severity} creates a new column named \textbf{severity} in the \textbf{proj.alz} dataset. 

\begin{lstlisting}[language=SAS,caption=Adding the severity column to the dataset,captionpos=b,label=lst:severity]
    data proj.alz; 
    set proj.alz; 
    if diabetes le 8.76 then severity='Low'; 
    else if diabetes gt 8.76 and diabetes le 9.4 then severity='Medium'; 
    else if diabetes gt 9.4 and diabetes le 10.62 then severity='High'; 
    else if diabetes gt 10.62 then severity='Severe'; 
    run;
\end{lstlisting}

The numeric range of the severity levels are based on the quartiles which were obtained by running the SAS program in Listing \ref{lst:quartiles}.

\begin{lstlisting}[language=SAS,caption=Obtaining quartiles for the diabetes variable,captionpos=b,label=lst:quartiles]
    proc univariate data=proj.alz;
    var diabetes;
    run;
\end{lstlisting}

Finally, the $\chi^2$ test is run using the code in Listing \ref{lst:chisq}.

\begin{lstlisting}[language=SAS,caption=$\chi^2$ test for homogeneity variable,captionpos=b,label=lst:chisq]
    proc freq data=proj.alz;
    table severity*state/chisq;
    run;
\end{lstlisting}

The test results are shown in Figure \ref{fig:chisq-results}. The frequency table of severity levels by state is shown in Figure \ref{fig:chisq-freq}.

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.7]{images/multiple-comparisons/chisq-results.png}
    \caption{$\chi^2$ test results}
    \label{fig:chisq-results}
\end{figure}

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.7]{images/multiple-comparisons/chisq-freq.png}
    \caption{$\chi^2$ frequency table}
    \label{fig:chisq-freq}
\end{figure}

\clearpage

\subsection{Interpretation}
The $p$-value for the $\chi^2$ test statistic is less than $\alpha$. Therefore, the null hypothesis that the groups are homogeneous is rejected. The frequency table shows marked differences between the groups. For instance, California and Washington have very few instances of severe and high levels of diabetes. The opposite is true for Georgia and Florida.

\section{Linear Regression}
Linear regression helps answer the question - "Is there a strong relationship between diabetes and physical inactivity?" Listing \ref{lst:reg} shows the SAS program that runs the regression.

\begin{lstlisting}[language=SAS,caption=Linear regression SAS program variable,captionpos=b,label=lst:reg]
    proc reg data=proj.alz;
    model diabetes=physical_inactivity/clb;
    run;
\end{lstlisting}

\subsection{Parameter estimates}
The parameter estimates for the slope and intercept are shown in Figure \ref{fig:reg-param-est}.

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.7]{images/regression/reg-param-est.png}
    \caption{Regression parameter estimates}
    \label{fig:reg-param-est}
\end{figure}

\subsubsection{Interpretation}
The regression equation is \begin{math} \text{diabetes}=3.0275+0.26031(\text{physical\_inactivity}) \end{math}. This means that as physical inactivity increases, so does the diabetes level. That is all that can be said. In order to make sense of the literal numeric values, more information about what the numbers represent, including units, need to be understood. 

The output also shows the 95\% confidence limits for the slope and intercept values. Lastly, the $p$-values denote the probability that the true slope and intercept are zero. Since the $p$-values for both are less than $\alpha$, the null hypotheses that the true slope and intercept are zero, is rejected.

Figure \ref{fig:reg-fit-plot} shows the regression fit plot. This plot shows the positive correlation between physical inactivity and diabetes.

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.3]{images/regression/reg-fit-plot.png}
    \caption{Regression fit plot}
    \label{fig:reg-fit-plot}
\end{figure}


\subsection{Fit Metrics}
Figure \ref{fig:reg-r-sq} shows the $R^2$ value of the regression. The value means that about 52\% of the total variability in diabetes level is explained by the linear regression of diabetes level on physical inactivity levels. This is a mediocre fit. Note that the $R^2$ value is different from the Pearson correlation coefficient shown in \ref{appendix:corr} for diabetes vs. physical activity. The mean square error, $MS_W$ is an important fit metric that can be used in conjunction with $R^2$ to compare the strength of fit between multiple independent variables.

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.7]{images/regression/reg-r-sq-mse.png}
    \caption{Fit metrics for physical inactivity vs. diabetes}
    \label{fig:reg-r-sq}
\end{figure}

The code in Listing \ref{lst:reg-multiple} runs the regression between (diabetes, smoking rate) and (diabetes, poverty percent). The fit metrics $R^2$ and $MS_W$ can be compared to determine which variable provides the best fit. \ref{tab:reg-multiple} shows that physical inactivity provides the best fit to the data as it has the highest $R_2$ and lowest $MS_W$. 

\begin{lstlisting}[language=SAS,caption=Linear regression SAS program for additional variables,captionpos=b,label=lst:reg-multiple]
    proc reg data=proj.alz;
    model diabetes=smoking_rate/clb;
    run;
    
    proc reg data=proj.alz;
    model diabetes=poverty_percent/clb;
    run;
\end{lstlisting}


\begin{table}[ht]
    \centering
    \begin{tabular}{|l|l|l|}
    \hline
         Variable & $R^2$  & $MS_W$ \\
         \hline
         physical inactivity& 0.5159  & 1.05256 \\
         \hline
         smoking rate & 	0.3817  & 1.34436 \\
         \hline
         poverty percent & 0.1718  & 1.80068 \\
         \hline
    \end{tabular}
    \caption{Fit statistics for the three variables}
    \label{tab:reg-multiple}
\end{table}

\clearpage

\section{Predictions}
$R_2$ and lowest $MS_W$ are not the best metrics to evaluate which variables are the best predictors of diabetes. Predicting means applying the model to new data as opposed to the existing data. Therefore, the PRESS metric is used instead. The code in Listing \ref{lst:reg-predict} outputs the PRESS metrics for physical inactivity, smoking rate, and poverty percent variables. The metrics are presented in Table \ref{tab:prediction}.

\begin{lstlisting}[language=SAS,caption=Linear regression SAS program for additional variables,captionpos=b,label=lst:reg-predict]
    proc reg data=proj.alz;
    model diabetes=physical_inactivity/cli clb p;
    run;
    
    proc reg data=proj.alz;
    model diabetes=smoking_rate/cli clb p;
    run;
    
    proc reg data=proj.proc reg data=proj.alz;;
    model diabetes=poverty_percent/cli clb p;
    run;
\end{lstlisting}

\begin{table}[ht]
    \centering
    \begin{tabular}{|l|l|l|}
    \hline
         Variable & Sum of squared residuals  & PRESS \\
         \hline
         physical inactivity& 746.26521  & 749.91380 \\
         \hline
         smoking rate & 	953.15029  & 958.52529 \\
         \hline
         poverty percent & 1276.67958  & 1284.90979 \\
         \hline
    \end{tabular}
    \caption{Prediction statistics for the three variables}
    \label{tab:prediction}
\end{table}

\subsection{Interpretation}
Physical inactivity is the best predictor of diabetes since it has the lowest PRESS value.

\clearpage

\section{Lack of Fit}
The data may be such that a linear regression model (as opposed to a polynomial model) is not appropriate. A lack of fit test is a statistical test that determines whether a linear regression model is appropriate. Listing \ref{lst:reg-lof} shows the SAS program used to run the lack of fit test.

\begin{lstlisting}[language=SAS,caption=SAS program for lack of fit test,captionpos=b,label=lst:reg-lof]
    proc reg data=proj.alz;
    model diabetes=physical_inactivity/lackfit;
    run;
\end{lstlisting}

Its output is shown in Figure \ref{fig:reg-lof}.

\subsection{Interpretation}
The $p$-value for the lack of fit test is greater than $\alpha$. Therefore, the null hypothesis that there is no lack of fit, is not rejected. A linear regression model seems appropriate.

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.7]{images/regression/reg-lof.png}
    \caption{Regression lack of fit results}
    \label{fig:reg-lof}
\end{figure}

\clearpage

\section{Appendix} \label{appendix}

\subsection{Box plots of diabetes by state} \label{appendix:boxplots}
\begin{table}[ht]
\centering
    \begin{tabular}{|cc|cc|cc|}
    \hline
         California &  \includegraphics[scale=0.6]{images/boxplots/ca.png}  & Florida  & \includegraphics[scale=0.6]{images/boxplots/fl.png} & Georgia & \includegraphics[scale=0.6]{images/boxplots/ga.png} \\
         \hline
         Texas & \includegraphics[scale=0.6]{images/boxplots/tx.png} & Virginia  & \includegraphics[scale=0.6]{images/boxplots/va.png} & Washington  & \includegraphics[scale=0.6]{images/boxplots/wa.png} \\
         \hline
    \end{tabular}
    
\end{table}

\clearpage

\subsection{Correlation coefficients} \label{appendix:corr}

\begin{figure}[ht]
    \centering
    \includegraphics[scale=0.7]{images/proc-corr.png}
    
\end{figure}

\clearpage

\subsection{Multiple comparisons test results for the diabetes variable} \label{appendix:mc-diabetes}

\begin{table}[ht]
    \begin{tabular}{|ll|ll|}
    \hline
         Fisher's LSD & \includegraphics[scale=0.6]{images/multiple-comparisons/lsd.png} & Bonferroni & \includegraphics[scale=0.6]{images/multiple-comparisons/bon.png} \\
         \hline
         Sidak & \includegraphics[scale=0.6]{images/multiple-comparisons/sidak.png}  & Tukey  & \includegraphics[scale=0.6]{images/multiple-comparisons/tukey.png} \\
         \hline
         SNK & \includegraphics[scale=0.6]{images/multiple-comparisons/snk.png}  & Duncan & \includegraphics[scale=0.6]{images/multiple-comparisons/duncan.png} \\
         \hline
    \end{tabular}
    
\end{table}

\clearpage

\subsection{Multiple comparisons test results for the cancer variable} \label{appendix:mc-cancer}

\begin{table}[ht]
    \begin{tabular}{|ll|ll|}
    \hline
         Fisher's LSD & \includegraphics[scale=0.6]{images/multiple-comparisons-cancer/lsd.png} & Bonferroni & \includegraphics[scale=0.6]{images/multiple-comparisons-cancer/bon.png} \\
         \hline
         Sidak & \includegraphics[scale=0.6]{images/multiple-comparisons-cancer/sidak.png}  & Tukey  & \includegraphics[scale=0.6]{images/multiple-comparisons-cancer/tukey.png} \\
         \hline
         SNK & \includegraphics[scale=0.6]{images/multiple-comparisons-cancer/snk.png}  & Duncan & \includegraphics[scale=0.6]{images/multiple-comparisons-cancer/duncan.png} \\
         \hline
    \end{tabular}
    
\end{table}

\clearpage

\bibliographystyle{plain}
\bibliography{refs}

\end{document}
